openapi: 3.0.3
info:
  title: Wordle Training API
  version: 1.0.0
  description: API for the Wordle training workshop

servers:
  - url: http://localhost:8080/kotlin-wordle-training/api
    description: Local development server

paths:
  /health:
    get:
      summary: Health check endpoint
      operationId: health
      tags:
        - Health
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /attempt:
    post:
      summary: Submit a word attempt
      description: |
        Validates the word and returns feedback for each letter.
        - Works for both authenticated and anonymous users
        - Returns feedback string (C=correct, P=present, A=absent)
        - Updates game state for authenticated users
      operationId: attemptWord
      tags:
        - Wordle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AttemptRequest"
      responses:
        "200":
          description: Attempt feedback
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AttemptResponse"
        "400":
          description: Invalid word (not 5 letters)

  /game-state:
    get:
      summary: Get current game state
      description: |
        Returns the current game state with all attempts made so far.
        - Authenticated: returns persisted game state
        - Anonymous: returns empty state (frontend uses localStorage)
      operationId: getGameState
      tags:
        - Wordle
      responses:
        "200":
          description: Current game state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GameStateResponse"
        "401":
          description: Unauthorized (only if token is invalid)

    post:
      summary: Save game state
      description: |
        Saves the game state from localStorage when user logs in.
        Transfers attempts from anonymous play to authenticated user.
        Requires authentication.
      operationId: saveGameState
      tags:
        - Wordle
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SaveGameStateRequest"
      responses:
        "200":
          description: Game state saved successfully
        "401":
          description: Unauthorized (authentication required)

  /leaderboard:
    get:
      summary: Get leaderboard
      description: |
        Returns the leaderboard with top players.
        Shows attempts and solve time for ranking.
        Requires authentication.
      operationId: getLeaderboard
      tags:
        - Wordle
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Leaderboard entries
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LeaderboardResponse"
        "401":
          description: Unauthorized (authentication required)

  /auth/login:
    get:
      summary: Initiate OAuth2 login flow
      description: |
        Redirects to OAuth2 provider (Keymock in dev) for authentication.
        After successful login, user is redirected back to the application with a token.
      operationId: login
      tags:
        - Authentication
      responses:
        "302":
          description: Redirect to OAuth2 provider

  /auth/callback:
    get:
      summary: OAuth2 callback endpoint
      description: |
        Handles the OAuth2 authorization code callback.
        Exchanges the code for a token and redirects to the frontend.
      operationId: authCallback
      tags:
        - Authentication
      parameters:
        - name: code
          in: query
          required: false
          schema:
            type: string
          description: Authorization code from OAuth2 provider
        - name: error
          in: query
          required: false
          schema:
            type: string
          description: Error code if authentication failed
      responses:
        "302":
          description: Redirect to frontend with token or error

  /auth/logout:
    post:
      summary: Logout user
      description: |
        Logout endpoint. With JWT stateless auth, the actual token
        invalidation happens on the client side by removing the token.
      operationId: logout
      tags:
        - Authentication
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out successfully"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: OAuth2 JWT token

  schemas:
    # Health schemas
    HealthResponse:
      $ref: "./schemas/health.yaml#/HealthResponse"
    # Wordle schemas
    GameStatus:
      $ref: "./schemas/wordle.yaml#/GameStatus"
    AttemptInfo:
      $ref: "./schemas/wordle.yaml#/AttemptInfo"
    AttemptRequest:
      $ref: "./schemas/wordle.yaml#/AttemptRequest"
    AttemptResponse:
      $ref: "./schemas/wordle.yaml#/AttemptResponse"
    GameStateResponse:
      $ref: "./schemas/wordle.yaml#/GameStateResponse"
    LeaderboardEntry:
      $ref: "./schemas/wordle.yaml#/LeaderboardEntry"
    LeaderboardResponse:
      $ref: "./schemas/wordle.yaml#/LeaderboardResponse"
    SaveGameStateRequest:
      $ref: "./schemas/wordle.yaml#/SaveGameStateRequest"
